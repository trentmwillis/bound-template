!<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">

  <title>BoundTemplate Tests</title>

  <link rel="stylesheet" href="../node_modules/qunitjs/qunit/qunit.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>

  <template id="test-basic">
    <p class="[[class]]">Hello [[name]],</p>

    <p class="[[class]] greeting">How are you doing <span>[[name]]</span>?</p>

    <div>
      <span title="Fare-thee-[[adjective]]">Fare-thee-[[adjective]].</span>
    </div>
  </template>

  <script src="../dist/bound-template.js"></script>
  <script src="../node_modules/qunitjs/qunit/qunit.js"></script>
  <script>
    QUnit.module('BoundTemplate', function() {

      QUnit.module('create', function() {

        QUnit.test('returns a template instance and a bindings object that syncs to the DOM', function(assert) {

          const template = new BoundTemplate(document.getElementById('test-basic'));
          const [instance, bindings] = template.create();

          assert.deepEqual(instance.textContent, `\n    Hello ,\n\n    How are you doing ?\n\n    \n      Fare-thee-.\n    \n  `);

          bindings.set('name', 'Zelda');
          bindings.set('adjective', 'well');

          assert.deepEqual(instance.textContent, `\n    Hello Zelda,\n\n    How are you doing Zelda?\n\n    \n      Fare-thee-well.\n    \n  `);

          bindings.set('name', 'Ganon');
          bindings.set('adjective', 'poorly');

          assert.deepEqual(instance.textContent, `\n    Hello Ganon,\n\n    How are you doing Ganon?\n\n    \n      Fare-thee-poorly.\n    \n  `);

        });

        QUnit.test('binds to attributes', function(assert) {

          const template = new BoundTemplate(document.getElementById('test-basic'));
          const [instance, bindings] = template.create();

          const simple = instance.querySelector('p');
          const greeting = instance.querySelector('.greeting');
          const farewell = instance.querySelector('span[title]');

          assert.notOk(simple.classList.contains('bold'));
          assert.notOk(greeting.classList.contains('bold'));
          assert.equal(farewell.getAttribute('title'), 'Fare-thee-');

          bindings.set('adjective', 'well');
          bindings.set('class', 'bold');

          assert.ok(simple.classList.contains('bold'));
          assert.ok(greeting.classList.contains('bold'));
          assert.equal(farewell.getAttribute('title'), 'Fare-thee-well');

          bindings.set('adjective', 'poorly');
          bindings.set('class', 'italic small');

          assert.equal(instance.querySelectorAll('.bold').length, 0);
          assert.equal(instance.querySelectorAll('.bold.greeting').length, 0);
          assert.equal(instance.querySelectorAll('[title="Fare-thee-well"]').length, 0);

          assert.equal(instance.querySelectorAll('.italic.small').length, 2);
          assert.equal(instance.querySelectorAll('.italic.small.greeting').length, 1);
          assert.equal(instance.querySelectorAll('[title="Fare-thee-poorly"]').length, 1);

        });

      });

    });
  </script>
</body>
</html>